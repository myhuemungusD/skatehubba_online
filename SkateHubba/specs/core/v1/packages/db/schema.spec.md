# Spec: Drizzle Schema â€“ Core Tables
ğŸ“ Path: /packages/db/schema.ts
ğŸ“¦ Depends on: Drizzle ORM, Neon Postgres, Drizzle Kit, Zod
ğŸ” Version: v1

---

## ğŸ¯ Purpose
Model the persistent data layer for SkateHubba, covering users, spots, check-ins, sessions, and achievements with referential integrity and type-safe access.

## âœ… Inputs
- Business requirements for profile, spots, check-ins, achievements, and notifications
- Migration configuration via drizzle.config.ts
- Enumerations for trick status, stance, and achievement tiers

## ğŸ“¤ Outputs
- Drizzle schema definitions and exported types (InferModel)
- Migration artifacts under /migrations generated by Drizzle Kit
- Seed helpers for local/dev environments (no production seeds)

## ğŸ“¦ Dependencies
- Postgres database connection (Neon)
- Drizzle relations() API for FK mapping
- Enum definitions shared with API SDK/types package
- Index + constraint strategy for performance (unique constraints, foreign keys, partial indexes)

## ğŸ§  Business Logic
1. Tables: users, spots, checkins, achievements, user_achievements, saved_spots, sessions (for server sessions), and audit_logs.
2. Enums: trick_status ["landed", "bailed", "retry"], stance ["regular", "goofy"], achievement_tier ["bronze", "silver", "gold", "legendary"].
3. Relations: checkins link user + spot; saved_spots link user + spot unique; user_achievements link user + achievement with progress + unlocked_at.
4. Constraints: prevent duplicate check-ins within short interval at DB layer via partial index on (user_id, spot_id, created_at bucket); enforce coordinate bounds for spots; cascade deletions carefully (e.g., spots cannot be deleted if checkins exist without archival flow).
5. Timestamps: use timezone-aware timestamps with default now(); include updated_at triggers where needed.
6. Privacy/security: store only signed URLs for media; no plaintext secrets; audit_logs table for mutations with actor + action + target.

## ğŸ§ª Validation
- Migration diff checks and linting via Drizzle Kit.
- Unit tests for enum exports, relation wiring, and schema-derived types.
- Integration tests exercising FK constraints and partial index behavior for duplicate protection.
